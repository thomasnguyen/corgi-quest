# Requirements Document: Corgi Quest MVP

## Introduction

Corgi Quest is a real-time multiplayer dog training RPG designed for couples to collaboratively track and gamify their dog's training progress. The system enables two partners to simultaneously log activities, view live stat updates, and work together toward daily training goals. The primary technical showcase is Convex's real-time synchronization capabilities, where actions by one partner appear instantly on the other partner's device. The application targets a 9-day hackathon timeline with emphasis on real-time multiplayer functionality, voice-based activity logging with OpenAI Realtime API for audio-to-audio conversations, and a minimalist black-and-white design from Figma.

## Glossary

- **System**: The Corgi Quest web application
- **User**: A person who is part of a household (partner in a couple)
- **Household**: A shared account containing two Users and one Dog
- **Dog**: The pet character being trained (e.g., "Bumi")
- **Stat**: One of four character attributes (Intelligence, Physical, Impulse Control, Socialization)
- **XP**: Experience points awarded to Stats when Activities are logged
- **Activity**: A logged training or exercise event (e.g., "Morning Walk", "Training Session")
- **Daily Goal**: Required points for Physical Stimulation (60 pts) and Mental Stimulation (45 pts) per day
- **Streak**: Consecutive days where both Daily Goals were met
- **Quest**: A suggested activity template with predefined point values
- **Convex**: The real-time backend database and subscription system
- **Real-Time Update**: Data changes that appear on all connected clients within 1 second
- **Voice Log**: Audio input from User that is processed by OpenAI Realtime API for real-time audio-to-audio conversation
- **OpenAI Realtime API**: AI service that processes voice input and provides spoken responses with function calling capabilities for structured data extraction
- **Function Calling**: OpenAI Realtime API capability to directly invoke System functions (e.g., saveActivity) with structured parameters
- **Audio Visualization**: Real-time visual feedback of audio input/output using @pipecat-ai/voice-ui-kit's VoiceVisualizer component
- **Session Token**: Temporary authentication token generated by Convex for OpenAI Realtime API WebSocket connections

## Requirements

### Requirement 1: Real-Time Multi-User Data Synchronization

**User Story:** As a User, I want to see my partner's logged activities appear on my screen instantly, so that we both stay informed about our Dog's training progress in real-time.

#### Acceptance Criteria

1. WHEN User A logs an Activity, THE System SHALL display the Activity in User B's activity feed within 1 second
2. WHEN an Activity awards XP to a Stat, THE System SHALL update the Stat's XP value and level on all connected clients within 1 second
3. WHEN Daily Goal points are updated, THE System SHALL reflect the new point totals in the top resource bar on all connected clients within 1 second
4. WHEN a Streak value changes, THE System SHALL update the Streak counter on all connected clients within 1 second
5. WHILE User A is logging an Activity, THE System SHALL display a presence indicator to User B showing "User A is logging..."

### Requirement 2: Shared Dog Character Profile

**User Story:** As a User, I want to view my Dog's character profile with current stats and level, so that I can see our training progress at a glance.

#### Acceptance Criteria

1. THE System SHALL display the Dog's name in the header of the Overview screen
2. THE System SHALL display the Dog's overall level as a badge next to the Dog's name
3. THE System SHALL display an XP progress bar showing current XP and XP required for the next level
4. THE System SHALL display a Dog portrait image as the focal point of the Overview screen
5. THE System SHALL display four Stat orbs below the Dog portrait, each showing the Stat abbreviation, current level, and XP progress ring

### Requirement 3: Four-Stat Character System

**User Story:** As a User, I want to track four distinct training stats for my Dog, so that I can see which areas need more focus.

#### Acceptance Criteria

1. THE System SHALL maintain four Stat types: Intelligence (INT), Physical (PHY), Impulse Control (IMP), and Socialization (SOC)
2. WHEN a Stat gains XP equal to or exceeding its XP-to-next-level threshold, THE System SHALL increment the Stat's level by 1 and reset XP to the overflow amount
3. THE System SHALL calculate XP-to-next-level thresholds that increase with each level
4. THE System SHALL display each Stat as a circular progress orb with visual indication of XP progress toward the next level
5. WHEN a User taps a Stat orb, THE System SHALL navigate to the Stat Detail screen for that Stat

### Requirement 4: Stat Detail View

**User Story:** As a User, I want to view detailed information about a specific Stat, so that I can understand how that Stat has progressed and what activities contribute to it.

#### Acceptance Criteria

1. THE System SHALL display the Stat name and current level in the header of the Stat Detail screen
2. THE System SHALL display a large XP progress bar showing percentage complete and numeric XP values
3. THE System SHALL display a list of recent Activities that awarded XP to this Stat, including Activity name, XP amount, and timestamp
4. THE System SHALL display suggested Activities that can earn XP for this Stat, including potential XP rewards
5. WHEN a partner logs an Activity that awards XP to the viewed Stat, THE System SHALL add the Activity to the "Recent Activities" list in real-time

### Requirement 5: Daily Goal Tracking System

**User Story:** As a User, I want to track daily Physical and Mental stimulation goals, so that I can ensure my Dog receives balanced training each day.

#### Acceptance Criteria

1. THE System SHALL create a new Daily Goal record each day with Physical goal of 60 points and Mental goal of 45 points
2. WHEN an Activity is logged, THE System SHALL add the Activity's Physical points to the current day's Physical total and Mental points to the Mental total
3. THE System SHALL display current Physical and Mental point progress in the top resource bar in the format "üí™ X/60 | üß† Y/45"
4. THE System SHALL reset Daily Goal points to 0 at midnight local time
5. WHEN both Physical and Mental goals are met for a day, THE System SHALL increment the Streak counter by 1

### Requirement 6: Streak Counter System

**User Story:** As a User, I want to maintain a streak of consecutive days meeting training goals, so that I stay motivated to train consistently.

#### Acceptance Criteria

1. THE System SHALL display the current Streak value with a fire emoji (üî•) in the top resource bar
2. WHEN both Daily Goals are met on a given day, THE System SHALL increment the Streak by 1 at midnight
3. WHEN either Daily Goal is not met on a given day, THE System SHALL reset the Streak to 0 at midnight
4. THE System SHALL maintain a record of the longest Streak achieved
5. THE System SHALL update the Streak value in real-time on all connected clients when it changes

### Requirement 7: Voice-Based Activity Logging

**User Story:** As a User, I want to log activities by speaking into my device and receive spoken confirmation, so that I can quickly record training sessions through natural conversation.

#### Acceptance Criteria

1. WHEN a User taps the "LOG ACTIVITY" button, THE System SHALL open the OpenAI Realtime API voice interface
2. WHEN a User speaks about an activity, THE System SHALL stream audio to OpenAI Realtime API via WebSocket
3. THE System SHALL display real-time audio visualization using @pipecat-ai/voice-ui-kit's VoiceVisualizer component
4. WHEN OpenAI Realtime API understands the activity, THE System SHALL receive spoken confirmation from OpenAI including activity name and XP awards
5. THE System SHALL automatically save the Activity to Convex without requiring manual confirmation
6. WHEN the Activity is saved, THE System SHALL redirect the User to the Activity feed screen

### Requirement 8: AI-Powered Activity Parsing with Function Calling

**User Story:** As a User, I want the system to automatically determine which stats and points to award based on my voice description, so that I don't have to manually select categories.

#### Acceptance Criteria

1. WHEN the OpenAI Realtime API receives audio input, THE System SHALL process it directly without text transcription
2. THE System SHALL use OpenAI's function calling to trigger saveActivity with structured data parameters
3. THE System SHALL determine which Stats should receive XP based on the activity description
4. THE System SHALL calculate XP amounts for each relevant Stat based on activity duration and type
5. THE System SHALL respond with spoken confirmation including activity name, duration, and XP awards for each Stat (e.g., "Logged! 20 minute walk - that's 30 XP for Physical and 13 XP for Social. Great job!")
6. THE System SHALL determine Physical and Mental point values based on activity type

### Requirement 9: Activity Confirmation and Editing

**DEPRECATED:** This requirement has been removed in favor of automatic confirmation through OpenAI Realtime API spoken responses. Activities are now saved immediately after OpenAI parses them and provides spoken confirmation, eliminating the need for a manual confirmation screen.

### Requirement 10: Shared Activity Feed

**User Story:** As a User, I want to see a chronological feed of all activities logged by both partners, so that I can review our training history.

#### Acceptance Criteria

1. THE System SHALL display Activities in reverse chronological order (newest first)
2. THE System SHALL display for each Activity: User avatar, Activity name, emoji indicating type, XP/points awarded, and timestamp
3. WHEN a new Activity is logged by either User, THE System SHALL add it to the top of the feed on all connected clients within 1 second
4. THE System SHALL load the 20 most recent Activities by default
5. THE System SHALL provide a way to load older Activities if needed

### Requirement 11: Quest System with Predefined Activities

**User Story:** As a User, I want to see suggested activities organized by category, so that I can quickly choose what to do with my Dog.

#### Acceptance Criteria

1. THE System SHALL display Physical Quests including: Morning Walk (30 pts), Fetch Session (15 pts), Dog Park Visit (40 pts), Long Walk 60min+ (50 pts)
2. THE System SHALL display Mental Quests including: Training Session (20 pts), Puzzle Toy (10 pts), New Trick Training (25 pts), Hide & Seek (15 pts)
3. THE System SHALL indicate which Quests have been completed today with a checkmark
4. WHEN a User taps a Quest, THE System SHALL display the Quest Detail screen with instructions
5. THE System SHALL allow Users to complete a Quest either by voice logging or by tapping a "Complete" button
6. THE System SHALL display the number of times each Quest has been completed today in gray text (e.g., "Done 2x today")
7. THE System SHALL visually highlight Quests that contribute to today's incomplete Daily Goals with a border or badge
8. THE System SHALL update Quest completion counts and Daily Goal indicators in real-time when Activities are logged

### Requirement 12: Quest Detail View

**User Story:** As a User, I want to view detailed information about a specific Quest, so that I understand what the activity involves and what rewards it provides.

#### Acceptance Criteria

1. THE System SHALL display the Quest name in the header
2. THE System SHALL display the Quest category (Physical or Mental)
3. THE System SHALL display the point value awarded upon completion
4. THE System SHALL display instructions or description for the Quest
5. THE System SHALL provide a "Complete Quest" button that opens the voice logging interface with the Quest name pre-filled

### Requirement 13: Progress Dashboard Overview

**User Story:** As a User, I want to see an overview of today's completed activities and overall progress, so that I can understand what we've accomplished.

#### Acceptance Criteria

1. THE System SHALL display a "Today's Breakdown" section showing all Physical activities completed today with point values
2. THE System SHALL display all Mental activities completed today with point values
3. THE System SHALL display the four Stat orbs as an overview of strengths and weaknesses
4. THE System SHALL display the current Streak with visual milestone markers
5. THE System SHALL display the Dog's overall level and XP progress bar

### Requirement 14: Three-Tab Bottom Navigation

**User Story:** As a User, I want to navigate between the main sections of the app using a bottom navigation bar, so that I can easily access different features.

#### Acceptance Criteria

1. THE System SHALL display a bottom navigation bar with three tabs: OVERVIEW, QUESTS, and ACTIVITY
2. WHEN a User taps the OVERVIEW tab, THE System SHALL display the Progress Dashboard screen
3. WHEN a User taps the QUESTS tab, THE System SHALL display the Quest System screen
4. WHEN a User taps the ACTIVITY tab, THE System SHALL display the Shared Activity Feed screen
5. THE System SHALL highlight the currently active tab

### Requirement 15: Fixed Log Activity Button

**User Story:** As a User, I want quick access to the activity logging feature from any screen, so that I can log activities immediately when they happen.

#### Acceptance Criteria

1. THE System SHALL display a "LOG ACTIVITY" button fixed above the bottom navigation bar
2. THE System SHALL make the button accessible from all three main navigation screens
3. WHEN a User taps the "LOG ACTIVITY" button, THE System SHALL open the voice logging interface
4. THE System SHALL style the button prominently to indicate it is the primary action
5. THE System SHALL ensure the button does not obscure important content on any screen

### Requirement 16: Top Resource Bar

**User Story:** As a User, I want to see key metrics at the top of every screen, so that I can quickly check daily progress and streak status.

#### Acceptance Criteria

1. THE System SHALL display a top resource bar on all main screens
2. THE System SHALL display "TODAY" label followed by Physical points progress (üí™ X/60)
3. THE System SHALL display Mental points progress (üß† Y/45)
4. THE System SHALL display the current Streak with fire emoji (üî• Z)
5. THE System SHALL update all values in real-time when Activities are logged

### Requirement 17: Database Schema Implementation

**User Story:** As a developer, I want a well-structured database schema in Convex, so that all data relationships are properly maintained and queryable.

#### Acceptance Criteria

1. THE System SHALL implement a users table with fields: id, name, email, household_id, created_at
2. THE System SHALL implement a households table with fields: id, dog_id, created_at
3. THE System SHALL implement a dogs table with fields: id, name, household_id, overall_level, overall_xp, xp_to_next_level, photo_url, created_at
4. THE System SHALL implement a dog_stats table with fields: id, dog_id, stat_type, level, xp, xp_to_next_level
5. THE System SHALL implement an activities table with fields: id, dog_id, user_id, activity_name, description, duration_minutes, created_at

### Requirement 18: Additional Database Tables

**User Story:** As a developer, I want to track activity stat gains, daily goals, and streaks in separate tables, so that the data model supports all required features.

#### Acceptance Criteria

1. THE System SHALL implement an activity_stat_gains table with fields: id, activity_id, stat_type, xp_amount
2. THE System SHALL implement a daily_goals table with fields: id, dog_id, date, physical_points, physical_goal, mental_points, mental_goal
3. THE System SHALL implement a streaks table with fields: id, dog_id, current_streak, longest_streak, last_activity_date
4. THE System SHALL use Convex validators (v.object, v.string, v.number, v.id) for all schema definitions
5. THE System SHALL enforce referential integrity through proper use of v.id() for foreign keys

### Requirement 19: Demo Data Seeding

**User Story:** As a developer, I want to seed the database with demo data, so that the application can be tested and demonstrated without manual data entry.

#### Acceptance Criteria

1. THE System SHALL provide a seed mutation that creates a Household with two Users named "You" and "Sarah"
2. THE System SHALL create a Dog named "Bumi" at level 8 with 4,500 XP
3. THE System SHALL create four dog_stats records with INT level 7, PHY level 9, IMP level 5, SOC level 6
4. THE System SHALL create a daily_goals record for today with Physical 45/60 and Mental 30/45
5. THE System SHALL create 3-4 sample Activities from the past few hours with realistic stat gains

### Requirement 20: Figma Design Implementation

**User Story:** As a developer, I want to implement the exact design from Figma, so that the application matches the intended visual design precisely.

#### Acceptance Criteria

1. THE System SHALL implement custom CSS or CSS modules to match the Figma design specifications
2. THE System SHALL use the exact colors, typography, spacing, and layout defined in the Figma design
3. THE System SHALL implement the black-and-white minimalist aesthetic as specified in Figma
4. THE System SHALL ensure mobile-first responsive design matching Figma breakpoints
5. THE System SHALL use Lucide React icons only where specified in the Figma design

### Requirement 21: Real-Time Toast Notifications

**User Story:** As a User, I want to receive toast notifications when my partner logs an activity, so that I'm immediately aware of their actions.

#### Acceptance Criteria

1. WHEN User B logs an Activity, THE System SHALL display a toast notification to User A within 1 second
2. THE System SHALL include in the toast: the User's name, the Activity name, and primary stat gain
3. THE System SHALL auto-dismiss the toast after 3 seconds
4. THE System SHALL stack multiple toasts if several Activities are logged in quick succession
5. THE System SHALL ensure toasts do not obscure critical UI elements

### Requirement 22: Level-Up Detection and Celebration

**User Story:** As a User, I want to see a celebration animation when my Dog levels up a stat, so that progress milestones feel rewarding.

#### Acceptance Criteria

1. WHEN a Stat's XP reaches or exceeds the XP-to-next-level threshold, THE System SHALL trigger a level-up event
2. THE System SHALL display a visual celebration animation on the Stat orb
3. THE System SHALL display a toast notification indicating which Stat leveled up
4. THE System SHALL update the Stat's level value and reset XP appropriately
5. THE System SHALL trigger the celebration on all connected clients in real-time

### Requirement 23: Optimistic UI Updates

**User Story:** As a User, I want the interface to respond immediately when I log an activity, so that the app feels fast and responsive.

#### Acceptance Criteria

1. WHEN a User submits an Activity, THE System SHALL immediately update the local UI before the server confirms
2. THE System SHALL display a loading indicator during the server round-trip
3. WHEN the server confirms the Activity, THE System SHALL reconcile any differences between optimistic and actual data
4. WHEN the server rejects an Activity, THE System SHALL revert the optimistic update and display an error message
5. THE System SHALL ensure optimistic updates do not cause visual glitches or data inconsistencies

### Requirement 24: Error Handling for Voice Logging

**User Story:** As a User, I want clear error messages if voice logging fails, so that I understand what went wrong and can try again.

#### Acceptance Criteria

1. WHEN the OpenAI Realtime API session fails to initialize, THE System SHALL display an error message and offer to retry
2. WHEN microphone permission is denied, THE System SHALL display a message with instructions to enable permissions
3. WHEN the WebSocket connection to OpenAI Realtime API is lost, THE System SHALL display "Connection lost" and attempt to reconnect automatically
4. WHEN OpenAI's function call to saveActivity fails, THE System SHALL display an error and allow the User to retry
5. WHEN network connectivity is lost during logging, THE System SHALL display offline status and queue retry when connection is restored
6. WHEN Session Token generation via Convex fails, THE System SHALL display an error message and prevent voice logging until resolved

### Requirement 25: Responsive Mobile-First Design

**User Story:** As a User, I want the app to work perfectly on my mobile device, so that I can log activities on-the-go.

#### Acceptance Criteria

1. THE System SHALL implement a mobile-first layout with max-width constraint for larger screens
2. THE System SHALL ensure all touch targets are at least 44x44 pixels for easy tapping
3. THE System SHALL use responsive font sizes that scale appropriately across device sizes
4. THE System SHALL ensure the voice logging interface is optimized for one-handed mobile use
5. THE System SHALL test and verify functionality on iOS Safari and Android Chrome browsers

### Requirement 26: Mood Tracking System

**User Story:** As a User, I want to log how Bumi is feeling throughout the day, so that we can track mood patterns and correlate them with activities to understand what helps Bumi stay calm and happy.

#### Acceptance Criteria

1. THE System SHALL provide a mood logging interface accessible from the Activity screen with a "LOG MOOD" button
2. THE System SHALL display six mood options: üòä Calm/Relaxed, üò∞ Anxious/Stressed, üò° Reactive/Aggressive, üéæ Playful/Energetic, üò¥ Tired/Overwhelmed, üòê Neutral
3. THE System SHALL allow Users to add an optional note (max 200 characters) when logging mood
4. THE System SHALL display mood entries in the Activity feed, mixed chronologically with activity entries
5. THE System SHALL visually distinguish mood entries from activity entries in the feed
6. THE System SHALL display the latest mood in the top resource bar as the 4th item (after streak, physical, mental) showing the mood emoji
7. THE System SHALL make the mood indicator in the resource bar tappable to open the mood picker
8. THE System SHALL update the resource bar mood indicator in real-time when either partner logs a mood
9. THE System SHALL show a dismissible daily reminder popup after 6pm local time if no mood has been logged today
10. THE System SHALL provide options in the reminder: "Log Mood Now", "Remind Me Later" (dismisses for 2 hours), or "Dismiss" (dismisses for the day)
11. THE System SHALL only show the daily reminder once per day
12. WHEN a partner logs a mood, THE System SHALL display it in the activity feed on all connected clients within 1 second
13. THE System SHALL display toast notification when partner logs mood: "Sarah logged: Bumi is üòä Calm"
14. THE System SHALL store mood logs with timestamp, user who logged it, optional note, and optional link to activity if logged together

### Requirement 27: AI-Powered Activity Recommendations

**User Story:** As a User, I want AI to analyze Bumi's mood patterns and activity history to suggest personalized daily activities, so that I can focus on activities that address mood issues, fill stat gaps, and meet daily goals.

#### Acceptance Criteria

1. THE System SHALL provide an "AI RECOMMENDATIONS" tab in the Quests screen alongside the "ALL QUESTS" tab
2. THE System SHALL use OpenAI API to analyze mood patterns from the last 7 days
3. THE System SHALL analyze activity history and outcomes to identify effective activities
4. THE System SHALL consider current stat levels and gaps when generating recommendations
5. THE System SHALL consider daily goal progress (physical and mental points) when generating recommendations
6. THE System SHALL generate 3-5 personalized activity recommendations per day
7. THE System SHALL display for each recommendation: activity name, reasoning (why it's recommended), expected mood impact, and XP rewards
8. THE System SHALL provide a "Log Activity" button for each recommendation that navigates to the voice logging interface with the activity pre-filled
9. THE System SHALL provide a "Refresh Recommendations" button to regenerate suggestions
10. THE System SHALL cache recommendations in Convex to avoid regenerating on every view
11. THE System SHALL show a loading state while generating recommendations
12. THE System SHALL handle errors gracefully if OpenAI API fails (show error message with retry option)
13. THE System SHALL display recommendations in a card-based layout with clear visual hierarchy
14. THE System SHALL update recommendations when new mood logs or activities are added (optional: auto-refresh or manual refresh)

---

## Implementation Notes

### OpenAI Realtime API Integration

The System requires the following technical components for OpenAI Realtime API integration:

1. **OpenAI API Key**: A valid OpenAI API key with access to the Realtime API must be configured as an environment variable
2. **Session Token Generation**: A Convex action must generate ephemeral session tokens for client-side WebSocket connections to OpenAI Realtime API
3. **Audio Visualization Library**: The @pipecat-ai/voice-ui-kit library must be installed and configured for the VoiceVisualizer component
4. **Function Calling Schema**: The saveActivity function must be defined in the OpenAI Realtime API configuration with proper parameter schemas for activity_name, duration_minutes, stat_gains (array), physical_points, and mental_points
5. **WebSocket Connection Management**: The client must establish and maintain a WebSocket connection to OpenAI Realtime API using the session token, with automatic reconnection on failure
6. **Audio Streaming**: The System must capture microphone audio and stream it to OpenAI in real-time, and play back OpenAI's audio responses through the device speakers
7. **Conversation Interruption Handling**: The System must support natural conversation interruptions similar to OpenAI's Advanced Voice Mode, allowing Users to interrupt OpenAI's responses

### Removed Components

The following components from the original design are no longer required:

1. **Web Speech API**: No longer used for voice transcription
2. **Text-based AI Parsing**: Replaced by OpenAI Realtime API for audio-to-audio processing
3. **Manual Confirmation Screen**: Removed in favor of automatic confirmation with spoken feedback
4. **Edit Functionality**: No longer needed as activities are saved immediately after spoken confirmation
